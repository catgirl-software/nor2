[gd_scene load_steps=3 format=3 uid="uid://oe1olw403qwt"]

[ext_resource type="PackedScene" uid="uid://lde3owvbf8ep" path="res://scenes/component_scenes/title_playerbox.tscn" id="1_7tju6"]

[sub_resource type="GDScript" id="GDScript_d1hpf"]
resource_name = "title_control"
script/source = "extends Control

@onready var level = preload(\"res://scenes/game_scenes/map1.tscn\")
@export var player_select_scene : PackedScene

@onready var button = $GridContainer/Button

func start_game():
	var players = $GridContainer.get_children()
	# Includes the button
	
	var teams : Array[int] = []
	for player in players:
		if player is PanelContainer:
			teams.append(player.team)
	ScoreTracker.initialise(teams, 5)
	RoundHandler.start()


func _add_player_button_pressed():
	if player_select_scene and $GridContainer.get_child_count() < 5:
		var new_item = player_select_scene.instantiate()
		new_item.starting_team = $GridContainer.get_child_count()
		$GridContainer.add_child(new_item)
		
		$GridContainer.move_child(button, $GridContainer.get_child_count() - 1)
		
		if $GridContainer.get_child_count() == 5:
			$GridContainer/Button.visible = false
"

[node name="title" type="Control"]
layout_mode = 3
anchors_preset = 0
offset_right = 960.0
offset_bottom = 540.0
script = SubResource("GDScript_d1hpf")
player_select_scene = ExtResource("1_7tju6")

[node name="RichTextLabel" type="RichTextLabel" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 443.0
offset_top = 373.0
offset_right = -477.0
offset_bottom = -127.0
scale = Vector2(2, 2)
text = "nor2"

[node name="Button" type="Button" parent="."]
layout_mode = 0
offset_left = 398.0
offset_top = 426.0
offset_right = 564.0
offset_bottom = 500.0
text = "nort harder"

[node name="GridContainer" type="GridContainer" parent="."]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -270.0
offset_top = 52.0
offset_right = 270.0
offset_bottom = 354.0
grow_horizontal = 2
theme_override_constants/h_separation = 140
theme_override_constants/v_separation = 50
columns = 2

[node name="p1" parent="GridContainer" instance=ExtResource("1_7tju6")]
layout_mode = 2
starting_team = 1

[node name="p2" parent="GridContainer" instance=ExtResource("1_7tju6")]
layout_mode = 2
starting_team = 2

[node name="Button" type="Button" parent="GridContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 80
text = "+"

[connection signal="pressed" from="Button" to="." method="start_game"]
[connection signal="pressed" from="GridContainer/Button" to="." method="_add_player_button_pressed"]
